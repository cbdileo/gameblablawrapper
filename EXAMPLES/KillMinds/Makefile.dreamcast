CC=kos-cc

SH_DIRECTORY=/opt/toolchains/dc/sh-elf/bin/

CFLAGS = -Os -Wall -DDREAMCAST -I$(KOS_BASE)/addons/include/SDL -I$(KOS_BASE)/addons/include
LDFLAGS = -lSDL -lmp3 -ltremor -lmp3 -lm
DEFINES = -DDEBUG -DSOUND_ENABLED -DJOYSTICK -DUNIX
DEFINES += -DSAVE -DDREAMCAST
OUTPUT = killminds_dreamcast

KOS_CFLAGS+=-DNO_FNMATCH
KOS_CFLAGS+=-DNO_NETWORK
KOS_CFLAGS+=-DNO_MIPMAPPING
KOS_CFLAGS+=-DNO_NORMALS
KOS_CFLAGS+=-DNO_COLORMATERIAL
KOS_CFLAGS+=-DNO_LIGHTING
KOS_CFLAGS+=-DNO_CLIP_PLANES
KOS_CFLAGS+=-DNO_DITHERING
KOS_CFLAGS+=-DFORCE_VERTEX_ARRAY
KOS_CFLAGS+=-DALLOC_GRANULARITY=32
KOS_CFLAGS+=-DNO_MEMORY_FUNCS
KOS_CFLAGS+=-DMEM_CACHE
KOS_CFLAGS+=-DUSE_MATH_INLINE
KOS_CFLAGS+=-DAUTO_FLUSH_VRAM
KOS_CFLAGS+=-DAUTO_FLUSH_LUMP
KOS_CFLAGS+=-DNO_ALPHA_TEST
KOS_CFLAGS+=-DINTOLERANT_MATH

SOURCES = main.c WRAPPER/DREAMCAST.c
OBJS = ${SOURCES:.c=.o}

${OUTPUT}:${OBJS}
	${CC} -o ${OUTPUT}.elf ${SOURCES} ${CFLAGS} ${LDFLAGS} ${DEFINES}
	
clean:
	rm *.o
	rm ${OUTPUT}
	
scramble:
	${SH_DIRECTORY}sh-elf-objcopy -R .stack -O binary ${OUTPUT}.elf ${OUTPUT}.bin
	
